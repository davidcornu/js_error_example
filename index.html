<html>
<head>

<style type="text/css">
  .errordialog{
    position: absolute;
    top: 100px;
    left: 50%;
    margin-left: -220px;
    width: 400px; 
    border: 10px solid #c9c9c9; 
    background: #eeeeee; 
    padding: 20px; 
    z-index: 9999;
    text-align: center;
  }
</style>

<script type="text/javascript">
  function errordialog(message, url, line){
    var dialog = document.createElement("div")
    dialog.className = 'errordialog'
    dialog.innerHTML = "Oops! Something has gone wrong. We're sending the details to the server so this doesn't happen again.<br/><br/><img id='javascript_error_loading' src='loading.gif' alt='Loading...'>"
    if(document.body){ document.body.appendChild(dialog) }
    
    var xmlhttp;
    if (window.XMLHttpRequest){
      xmlhttp=new XMLHttpRequest();
    } else {
      xmlhttp=new ActiveXObject("Microsoft.XMLHTTP");
    }
        
    xmlhttp.open("GET", "/js_error?message=" + encodeURIComponent(message) + "&url=" + encodeURIComponent(url) + "&line=" + line, true);
    xmlhttp.send();
    xmlhttp.onreadystatechange = function(){
      if (xmlhttp.readyState==4 && xmlhttp.status==200){
        document.getElementById('javascript_error_loading').style.display = 'none';
        dialog.innerHTML += "<a href='#' onClick='window.location.reload()'>Reload Page</a>";
      }
    }
    return true
  }

  window.onerror = function(message, url, line){
    return errordialog(message, url, line)
  }
</script>

<body>

<script type="text/javascript">
  document.write('hi there'
</script>

</body>
</html>